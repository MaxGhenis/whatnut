{"version":3,"kind":"Notebook","sha256":"190cdeb217e7ef02148b9fd2ed86bdca0a8ab99a9c57865ee9cf25124be78a21","slug":"simulation","location":"/notebooks/simulation.ipynb","dependencies":[],"frontmatter":{"title":"Monte Carlo Simulation","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Max Ghenis","given":"Max","family":"Ghenis"},"name":"Max Ghenis","email":"max@maxghenis.com","id":"contributors-myst-generated-uid-0","corresponding":true}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"github":"https://github.com/MaxGhenis/whatnut","numbering":{"title":{"offset":1}},"source_url":"https://github.com/MaxGhenis/whatnut/blob/master/docs/notebooks/simulation.ipynb","edit_url":"https://github.com/MaxGhenis/whatnut/edit/master/docs/notebooks/simulation.ipynb","exports":[{"format":"ipynb","filename":"simulation.ipynb","url":"/whatnut//build/simulation-ea6ad5d028a98b2b23fc10172669bc30.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates the Monte Carlo simulation methodology.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R6EYL2lruI"}],"key":"mYQx9SiRUd"}],"key":"JuM4KMmPRS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom whatnut import MonteCarloSimulation, DEFAULT_PARAMS\nfrom whatnut.nuts import NUTS, get_nut\n\nsns.set_style('whitegrid')\nplt.rcParams['figure.figsize'] = (10, 6)","key":"tSDTrGgLWj"},{"type":"outputs","id":"ap8UR2Ih8-86KMntkAhC_","children":[],"key":"AscuLCm5tY"}],"key":"TRaeVNuG1A"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Nut Properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EZVEi9KRNG"}],"identifier":"nut-properties","label":"Nut Properties","html_id":"nut-properties","implicit":true,"key":"vJbxvTezS3"}],"key":"T1EJNeRH62"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\n\nnut_data = []\nfor nut in NUTS:\n    nut_data.append({\n        'Nut': nut.name,\n        'Adjustment Mean': nut.adjustment_factor.mean,\n        'Adjustment SD': nut.adjustment_factor.sd,\n        'Evidence': nut.evidence_strength,\n        'Protein (g)': nut.nutrients.protein_g,\n        'Omega-3 (g)': nut.nutrients.omega3_g,\n        'Omega-6 (g)': nut.nutrients.omega6_g,\n    })\n\npd.DataFrame(nut_data)","key":"XnNEEsd6Hg"},{"type":"outputs","id":"utEinkoMZ_nlT0YJMDHfs","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"         Nut  Adjustment Mean  Adjustment SD  Evidence  Protein (g)  \\\n0     Walnut             1.15           0.08    strong         15.2   \n1     Almond             1.00           0.06  moderate         21.2   \n2  Pistachio             1.08           0.10  moderate         20.2   \n3  Macadamia             1.02           0.15   limited          7.9   \n4     Peanut             0.95           0.07    strong         25.8   \n5      Pecan             0.98           0.18   limited          9.2   \n6     Cashew             0.92           0.14   limited         18.2   \n\n   Omega-3 (g)  Omega-6 (g)  \n0        9.080         38.1  \n1        0.003         12.3  \n2        0.250         13.2  \n3        0.210          1.3  \n4        0.003         15.6  \n5        0.990         20.6  \n6        0.060          7.8  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Nut</th>\n      <th>Adjustment Mean</th>\n      <th>Adjustment SD</th>\n      <th>Evidence</th>\n      <th>Protein (g)</th>\n      <th>Omega-3 (g)</th>\n      <th>Omega-6 (g)</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Walnut</td>\n      <td>1.15</td>\n      <td>0.08</td>\n      <td>strong</td>\n      <td>15.2</td>\n      <td>9.080</td>\n      <td>38.1</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Almond</td>\n      <td>1.00</td>\n      <td>0.06</td>\n      <td>moderate</td>\n      <td>21.2</td>\n      <td>0.003</td>\n      <td>12.3</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Pistachio</td>\n      <td>1.08</td>\n      <td>0.10</td>\n      <td>moderate</td>\n      <td>20.2</td>\n      <td>0.250</td>\n      <td>13.2</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Macadamia</td>\n      <td>1.02</td>\n      <td>0.15</td>\n      <td>limited</td>\n      <td>7.9</td>\n      <td>0.210</td>\n      <td>1.3</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Peanut</td>\n      <td>0.95</td>\n      <td>0.07</td>\n      <td>strong</td>\n      <td>25.8</td>\n      <td>0.003</td>\n      <td>15.6</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>Pecan</td>\n      <td>0.98</td>\n      <td>0.18</td>\n      <td>limited</td>\n      <td>9.2</td>\n      <td>0.990</td>\n      <td>20.6</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>Cashew</td>\n      <td>0.92</td>\n      <td>0.14</td>\n      <td>limited</td>\n      <td>18.2</td>\n      <td>0.060</td>\n      <td>7.8</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"WAMKaE2fI2"}],"key":"ZqEbD4XpMn"}],"key":"NmMnMkvQTc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XmBbmM741T"}],"identifier":"run-simulation","label":"Run Simulation","html_id":"run-simulation","implicit":true,"key":"xg83wkxpld"}],"key":"nWhzpeNJHh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sim = MonteCarloSimulation(seed=42)\nresult = sim.run(DEFAULT_PARAMS)\n\nprint(f\"Ran {DEFAULT_PARAMS.n_simulations:,} simulations\")\nprint(f\"Category effect (any nut): {result.category_effect.median:.2f} QALYs\")","key":"VP5eowRAr9"},{"type":"outputs","id":"bJeowGLzXnkST-2mlBjO3","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Ran 10,000 simulations\nCategory effect (any nut): 2.59 QALYs\n"},"key":"b06EyEqY4J"}],"key":"vWQLeNZxoI"}],"key":"NXeWspjAvP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Distribution of QALY Samples","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RDgTboYuuc"}],"identifier":"distribution-of-qaly-samples","label":"Distribution of QALY Samples","html_id":"distribution-of-qaly-samples","implicit":true,"key":"b5BQFcQpwp"}],"key":"fx7jTbReV8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axes = plt.subplots(2, 4, figsize=(14, 8))\naxes = axes.flatten()\n\nfor i, nut_result in enumerate(result.results):\n    if i >= 7:\n        break\n    ax = axes[i]\n    ax.hist(nut_result.samples, bins=50, alpha=0.7, edgecolor='black')\n    ax.axvline(nut_result.median, color='red', linestyle='--', label=f'Median: {nut_result.median:.2f}')\n    ax.set_title(nut_result.nut_id.capitalize())\n    ax.set_xlabel('QALYs')\n    ax.legend()\n\n# Hide last subplot\naxes[-1].axis('off')\nplt.tight_layout()\nplt.suptitle('QALY Distribution by Nut Type', y=1.02, fontsize=14)\nplt.show()","key":"UG1dEUckCL"},{"type":"outputs","id":"Jt22vtrHwFGDDaxOIGYNo","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1400x800 with 8 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2e9b5e23daba0ce5eb952e28f16e67ec","path":"/whatnut//build/2e9b5e23daba0ce5eb952e28f16e67ec.png"}}},"key":"XRuZwukJmL"}],"key":"dVhJyf8Wna"}],"key":"Ip58iWgBZE"}],"key":"frjWlLLLS4"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Evidence Review","url":"/evidence","group":"Analysis"},"next":{"title":"Results","url":"/results","group":"Analysis"}}},"domain":"http://localhost:3007"}