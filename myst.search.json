{"version":"1","records":[{"hierarchy":{"lvl1":"What Nut?"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"What Nut?"},"content":"A Bayesian QALY Analysis of Nut Consumption","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"What Nut?","lvl2":"The Question"},"type":"lvl2","url":"/#the-question","position":2},{"hierarchy":{"lvl1":"What Nut?","lvl2":"The Question"},"content":"How many quality-adjusted life years (QALYs) do you gain from eating different types of nuts?","type":"content","url":"/#the-question","position":3},{"hierarchy":{"lvl1":"What Nut?","lvl2":"Key Finding"},"type":"lvl2","url":"/#key-finding","position":4},{"hierarchy":{"lvl1":"What Nut?","lvl2":"Key Finding"},"content":"Eating any nut daily: ~2.5 QALYs. The difference between “best” (walnuts) and “worst” (cashews) is only ~0.7 QALYs. Eat whichever nut you’ll actually eat consistently.","type":"content","url":"/#key-finding","position":5},{"hierarchy":{"lvl1":"What Nut?","lvl2":"This Analysis"},"type":"lvl2","url":"/#this-analysis","position":6},{"hierarchy":{"lvl1":"What Nut?","lvl2":"This Analysis"},"content":"This document presents a rigorous, evidence-based analysis that:\n\nTraces every claim to primary sources - Meta-analyses, RCTs, cohort studies\n\nQuantifies uncertainty - Monte Carlo simulation with 10,000 iterations\n\nApplies Bayesian reasoning - Sparse evidence widens confidence intervals, doesn’t lower point estimates","type":"content","url":"/#this-analysis","position":7},{"hierarchy":{"lvl1":"What Nut?","lvl2":"Table of Contents"},"type":"lvl2","url":"/#table-of-contents","position":8},{"hierarchy":{"lvl1":"What Nut?","lvl2":"Table of Contents"},"content":"What Nut?\n\nMethodology\n\nAnalysis\n\nEvidence Review\n\nMonte Carlo Simulation\n\nResults","type":"content","url":"/#table-of-contents","position":9},{"hierarchy":{"lvl1":"What Nut?","lvl2":"Quick Start"},"type":"lvl2","url":"/#quick-start","position":10},{"hierarchy":{"lvl1":"What Nut?","lvl2":"Quick Start"},"content":"from whatnut import MonteCarloSimulation, DEFAULT_PARAMS\n\nsim = MonteCarloSimulation(seed=42)\nresult = sim.run(DEFAULT_PARAMS)\n\nfor nut in result.results[:3]:\n    print(f\"{nut.nut_id}: {nut.median:.2f} QALYs (95% CI: [{nut.ci_95[0]:.1f}, {nut.ci_95[1]:.1f}])\")","type":"content","url":"/#quick-start","position":11},{"hierarchy":{"lvl1":"Methodology"},"type":"lvl1","url":"/methodology","position":0},{"hierarchy":{"lvl1":"Methodology"},"content":"","type":"content","url":"/methodology","position":1},{"hierarchy":{"lvl1":"Methodology","lvl2":"Overview"},"type":"lvl2","url":"/methodology#overview","position":2},{"hierarchy":{"lvl1":"Methodology","lvl2":"Overview"},"content":"This analysis estimates the lifetime QALY impact of regular nut consumption using a Bayesian Monte Carlo framework.","type":"content","url":"/methodology#overview","position":3},{"hierarchy":{"lvl1":"Methodology","lvl2":"Evidence Hierarchy"},"type":"lvl2","url":"/methodology#evidence-hierarchy","position":4},{"hierarchy":{"lvl1":"Methodology","lvl2":"Evidence Hierarchy"},"content":"We use the following evidence sources, in order of strength:\n\nMeta-analyses of mortality outcomes - Aune 2016, Grosso 2015\n\nLarge cohort studies - Bao 2013 (NEJM), Guasch-Ferré 2017\n\nRandomized controlled trials - PREDIMED, WAHA\n\nNutrient composition data - USDA FoodData Central","type":"content","url":"/methodology#evidence-hierarchy","position":5},{"hierarchy":{"lvl1":"Methodology","lvl2":"Key Parameters"},"type":"lvl2","url":"/methodology#key-parameters","position":6},{"hierarchy":{"lvl1":"Methodology","lvl2":"Key Parameters"},"content":"","type":"content","url":"/methodology#key-parameters","position":7},{"hierarchy":{"lvl1":"Methodology","lvl3":"Base Mortality Effect","lvl2":"Key Parameters"},"type":"lvl3","url":"/methodology#base-mortality-effect","position":8},{"hierarchy":{"lvl1":"Methodology","lvl3":"Base Mortality Effect","lvl2":"Key Parameters"},"content":"From Aune et al. 2016 meta-analysis (n=819,448):\n\nRelative Risk: 0.78 (95% CI: 0.72-0.84)\n\nInterpretation: 22% reduced all-cause mortality per 28g/day","type":"content","url":"/methodology#base-mortality-effect","position":9},{"hierarchy":{"lvl1":"Methodology","lvl3":"Nut-Specific Adjustments","lvl2":"Key Parameters"},"type":"lvl3","url":"/methodology#nut-specific-adjustments","position":10},{"hierarchy":{"lvl1":"Methodology","lvl3":"Nut-Specific Adjustments","lvl2":"Key Parameters"},"content":"Each nut receives an adjustment factor based on:\n\nNut-specific outcome studies (if available)\n\nUnique nutrient properties (omega-3, omega-7, etc.)\n\nEvidence quality (affects uncertainty, not point estimate)\n\nNut\n\nAdjustment\n\nSD\n\nRationale\n\nWalnut\n\n1.15\n\n0.08\n\nStrongest CVD data, unique omega-3\n\nPistachio\n\n1.08\n\n0.10\n\nBest lipid improvements\n\nAlmond\n\n1.00\n\n0.06\n\nReference, robust RCT base\n\nMacadamia\n\n1.02\n\n0.15\n\nLimited evidence, FDA health claim\n\nPeanut\n\n0.95\n\n0.07\n\nLarge cohort data, slight aflatoxin discount\n\nPecan\n\n0.98\n\n0.18\n\nMinimal nut-specific evidence\n\nCashew\n\n0.92\n\n0.14\n\nLower fiber, limited RCT data","type":"content","url":"/methodology#nut-specific-adjustments","position":11},{"hierarchy":{"lvl1":"Methodology","lvl3":"Bayesian Principle","lvl2":"Key Parameters"},"type":"lvl3","url":"/methodology#bayesian-principle","position":12},{"hierarchy":{"lvl1":"Methodology","lvl3":"Bayesian Principle","lvl2":"Key Parameters"},"content":"Sparse evidence should widen confidence intervals, not lower point estimates.\n\nFor nuts with less evidence (macadamia, pecan), we:\n\nKeep the point estimate near the category prior (~2.5 QALYs)\n\nIncrease the uncertainty (higher SD)\n\nThis differs from naive approaches that penalize low-evidence options.","type":"content","url":"/methodology#bayesian-principle","position":13},{"hierarchy":{"lvl1":"Methodology","lvl2":"Simulation Steps"},"type":"lvl2","url":"/methodology#simulation-steps","position":14},{"hierarchy":{"lvl1":"Methodology","lvl2":"Simulation Steps"},"content":"For each of 10,000 iterations:\n\nSample base hazard ratio: HR \\sim \\text{LogNormal}(\\log(0.78), 0.08)\n\nSample nut-specific adjustment: a \\sim \\text{Normal}(\\mu_{nut}, \\sigma_{nut})\n\nCompute adjusted HR: HR_{adj} = HR^a\n\nCompute years of life gained: YLG = YLG_{base} \\times \\frac{1 - HR_{adj}}{1 - 0.78}\n\nSample quality weight: q \\sim \\text{Beta}(17, 3)\n\nSample confounding adjustment: c \\sim \\text{Beta}(8, 2)\n\nCompute QALYs: QALY = YLG \\times q \\times c + LE \\times QoL_{effect} \\times q \\times c","type":"content","url":"/methodology#simulation-steps","position":15},{"hierarchy":{"lvl1":"Methodology","lvl2":"Limitations"},"type":"lvl2","url":"/methodology#limitations","position":16},{"hierarchy":{"lvl1":"Methodology","lvl2":"Limitations"},"content":"Confounding: Observational studies can’t fully separate nut effect from healthy user bias\n\nGeneralizability: Most studies are from Western populations\n\nDose-response: We model daily consumption; actual effects may vary\n\nNut-specific evidence: Very limited for some nuts (pecan, cashew)","type":"content","url":"/methodology#limitations","position":17},{"hierarchy":{"lvl1":"Evidence Review"},"type":"lvl1","url":"/evidence","position":0},{"hierarchy":{"lvl1":"Evidence Review"},"content":"This notebook reviews all primary sources used in the analysis.\n\nfrom whatnut.evidence import SOURCES, validate_sources\nimport pandas as pd\n\n\n\n","type":"content","url":"/evidence","position":1},{"hierarchy":{"lvl1":"Evidence Review","lvl2":"All Sources"},"type":"lvl2","url":"/evidence#all-sources","position":2},{"hierarchy":{"lvl1":"Evidence Review","lvl2":"All Sources"},"content":"\n\n# Convert sources to DataFrame for display\nsource_data = []\nfor s in SOURCES:\n    source_data.append({\n        'ID': s.id,\n        'Type': s.study_type,\n        'Citation': s.citation[:60] + '...' if len(s.citation) > 60 else s.citation,\n        'Key Finding': s.key_finding,\n        'Sample Size': s.sample_size,\n    })\n\npd.DataFrame(source_data)\n\n\n\n","type":"content","url":"/evidence#all-sources","position":3},{"hierarchy":{"lvl1":"Evidence Review","lvl2":"Effect Sizes from Meta-Analyses"},"type":"lvl2","url":"/evidence#effect-sizes-from-meta-analyses","position":4},{"hierarchy":{"lvl1":"Evidence Review","lvl2":"Effect Sizes from Meta-Analyses"},"content":"\n\neffect_data = []\nfor s in SOURCES:\n    if s.effect_size is not None:\n        effect_data.append({\n            'Source': s.id,\n            'Metric': s.effect_size.metric,\n            'Point Estimate': s.effect_size.point_estimate,\n            'CI Lower': s.effect_size.ci_lower,\n            'CI Upper': s.effect_size.ci_upper,\n        })\n\npd.DataFrame(effect_data)\n\n\n\n","type":"content","url":"/evidence#effect-sizes-from-meta-analyses","position":5},{"hierarchy":{"lvl1":"Evidence Review","lvl2":"Validation"},"type":"lvl2","url":"/evidence#validation","position":6},{"hierarchy":{"lvl1":"Evidence Review","lvl2":"Validation"},"content":"\n\nerrors = validate_sources()\nif errors:\n    print(\"Validation errors:\")\n    for e in errors:\n        print(f\"  - {e}\")\nelse:\n    print(\"✓ All sources pass validation\")\n\n","type":"content","url":"/evidence#validation","position":7},{"hierarchy":{"lvl1":"Results"},"type":"lvl1","url":"/results","position":0},{"hierarchy":{"lvl1":"Results"},"content":"Final QALY estimates with uncertainty quantification.\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport pandas as pd\nfrom whatnut import MonteCarloSimulation, DEFAULT_PARAMS\n\nsim = MonteCarloSimulation(seed=42)\nresult = sim.run(DEFAULT_PARAMS)\n\n\n\n","type":"content","url":"/results","position":1},{"hierarchy":{"lvl1":"Results","lvl2":"Summary Table"},"type":"lvl2","url":"/results#summary-table","position":2},{"hierarchy":{"lvl1":"Results","lvl2":"Summary Table"},"content":"\n\nsummary = []\nfor r in result.results:\n    summary.append({\n        'Nut': r.nut_id.capitalize(),\n        'Median QALYs': f\"{r.median:.2f}\",\n        '95% CI': f\"[{r.ci_95[0]:.1f}, {r.ci_95[1]:.1f}]\",\n        'P(positive)': f\"{r.p_positive:.1%}\",\n        'P(>1 year)': f\"{r.p_gt_1_year:.1%}\",\n    })\n\npd.DataFrame(summary)\n\n\n\n","type":"content","url":"/results#summary-table","position":3},{"hierarchy":{"lvl1":"Results","lvl2":"Forest Plot"},"type":"lvl2","url":"/results#forest-plot","position":4},{"hierarchy":{"lvl1":"Results","lvl2":"Forest Plot"},"content":"\n\nfig, ax = plt.subplots(figsize=(10, 6))\n\nnuts = [r.nut_id.capitalize() for r in result.results]\nmedians = [r.median for r in result.results]\nci_low = [r.ci_95[0] for r in result.results]\nci_high = [r.ci_95[1] for r in result.results]\n\ny_pos = np.arange(len(nuts))\n\n# Plot error bars\nax.errorbar(medians, y_pos, xerr=[np.array(medians) - np.array(ci_low), \n                                   np.array(ci_high) - np.array(medians)],\n            fmt='o', capsize=5, capthick=2, markersize=10, color='teal')\n\n# Add reference line for category effect\nax.axvline(result.category_effect.median, color='gray', linestyle='--', \n           label=f'Any nut: {result.category_effect.median:.1f} QALYs')\n\nax.set_yticks(y_pos)\nax.set_yticklabels(nuts)\nax.set_xlabel('QALYs (95% CI)')\nax.set_title('Lifetime QALY Impact by Nut Type')\nax.legend()\nax.invert_yaxis()\n\nplt.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/results#forest-plot","position":5},{"hierarchy":{"lvl1":"Results","lvl2":"Key Insights"},"type":"lvl2","url":"/results#key-insights","position":6},{"hierarchy":{"lvl1":"Results","lvl2":"Key Insights"},"content":"Walnut leads with ~2.9 QALYs, driven by strong CVD outcome data and unique omega-3 content\n\nThe spread is small - only ~0.7 QALYs between best (walnut) and worst (cashew)\n\nAny nut beats no nuts - the category effect (~2.5 QALYs) far exceeds nut choice effects\n\nUncertainty varies - nuts with less evidence (pecan, macadamia) have wider CIs\n\n","type":"content","url":"/results#key-insights","position":7},{"hierarchy":{"lvl1":"Results","lvl2":"Sensitivity Analysis"},"type":"lvl2","url":"/results#sensitivity-analysis","position":8},{"hierarchy":{"lvl1":"Results","lvl2":"Sensitivity Analysis"},"content":"\n\nfrom whatnut.simulation import SimulationParams\n\n# Test different confounding assumptions\n# 0.6 = 60% causal effect, 40% confounding\n# 0.99 = nearly all causal\nconfounding_levels = [0.6, 0.7, 0.8, 0.9, 0.95]\nsensitivity_results = []\n\nfor conf in confounding_levels:\n    params = SimulationParams(confounding_adjustment=conf, n_simulations=5000)\n    res = sim.run(params)\n    walnut = next(r for r in res.results if r.nut_id == 'walnut')\n    sensitivity_results.append({\n        'Confounding': f\"{conf:.0%} causal\",\n        'Walnut QALYs': f\"{walnut.median:.2f}\",\n        'Category Effect': f\"{res.category_effect.median:.2f}\",\n    })\n\npd.DataFrame(sensitivity_results)\n\n","type":"content","url":"/results#sensitivity-analysis","position":9},{"hierarchy":{"lvl1":"Monte Carlo Simulation"},"type":"lvl1","url":"/simulation","position":0},{"hierarchy":{"lvl1":"Monte Carlo Simulation"},"content":"This notebook demonstrates the Monte Carlo simulation methodology.\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom whatnut import MonteCarloSimulation, DEFAULT_PARAMS\nfrom whatnut.nuts import NUTS, get_nut\n\nsns.set_style('whitegrid')\nplt.rcParams['figure.figsize'] = (10, 6)\n\n\n\n","type":"content","url":"/simulation","position":1},{"hierarchy":{"lvl1":"Monte Carlo Simulation","lvl2":"Nut Properties"},"type":"lvl2","url":"/simulation#nut-properties","position":2},{"hierarchy":{"lvl1":"Monte Carlo Simulation","lvl2":"Nut Properties"},"content":"\n\nimport pandas as pd\n\nnut_data = []\nfor nut in NUTS:\n    nut_data.append({\n        'Nut': nut.name,\n        'Adjustment Mean': nut.adjustment_factor.mean,\n        'Adjustment SD': nut.adjustment_factor.sd,\n        'Evidence': nut.evidence_strength,\n        'Protein (g)': nut.nutrients.protein_g,\n        'Omega-3 (g)': nut.nutrients.omega3_g,\n        'Omega-6 (g)': nut.nutrients.omega6_g,\n    })\n\npd.DataFrame(nut_data)\n\n\n\n","type":"content","url":"/simulation#nut-properties","position":3},{"hierarchy":{"lvl1":"Monte Carlo Simulation","lvl2":"Run Simulation"},"type":"lvl2","url":"/simulation#run-simulation","position":4},{"hierarchy":{"lvl1":"Monte Carlo Simulation","lvl2":"Run Simulation"},"content":"\n\nsim = MonteCarloSimulation(seed=42)\nresult = sim.run(DEFAULT_PARAMS)\n\nprint(f\"Ran {DEFAULT_PARAMS.n_simulations:,} simulations\")\nprint(f\"Category effect (any nut): {result.category_effect.median:.2f} QALYs\")\n\n\n\n","type":"content","url":"/simulation#run-simulation","position":5},{"hierarchy":{"lvl1":"Monte Carlo Simulation","lvl2":"Distribution of QALY Samples"},"type":"lvl2","url":"/simulation#distribution-of-qaly-samples","position":6},{"hierarchy":{"lvl1":"Monte Carlo Simulation","lvl2":"Distribution of QALY Samples"},"content":"\n\nfig, axes = plt.subplots(2, 4, figsize=(14, 8))\naxes = axes.flatten()\n\nfor i, nut_result in enumerate(result.results):\n    if i >= 7:\n        break\n    ax = axes[i]\n    ax.hist(nut_result.samples, bins=50, alpha=0.7, edgecolor='black')\n    ax.axvline(nut_result.median, color='red', linestyle='--', label=f'Median: {nut_result.median:.2f}')\n    ax.set_title(nut_result.nut_id.capitalize())\n    ax.set_xlabel('QALYs')\n    ax.legend()\n\n# Hide last subplot\naxes[-1].axis('off')\nplt.tight_layout()\nplt.suptitle('QALY Distribution by Nut Type', y=1.02, fontsize=14)\nplt.show()\n\n","type":"content","url":"/simulation#distribution-of-qaly-samples","position":7}]}