{"version":3,"kind":"Notebook","sha256":"1b56a4f6f9d6ab7f68a6c07bcef9f2e3ad8c57013ae726bd2e483e1b706a055d","slug":"results","location":"/notebooks/results.ipynb","dependencies":[],"frontmatter":{"title":"Results","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Max Ghenis","given":"Max","family":"Ghenis"},"name":"Max Ghenis","email":"max@maxghenis.com","id":"contributors-myst-generated-uid-0","corresponding":true}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"github":"https://github.com/MaxGhenis/whatnut","numbering":{"title":{"offset":1}},"source_url":"https://github.com/MaxGhenis/whatnut/blob/master/docs/notebooks/results.ipynb","edit_url":"https://github.com/MaxGhenis/whatnut/edit/master/docs/notebooks/results.ipynb","exports":[{"format":"ipynb","filename":"results.ipynb","url":"/whatnut//build/results-a7ddeb9514938394a35608a58c517d38.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Final QALY estimates with uncertainty quantification.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YRk7EY6heb"}],"key":"a4Mck3aX6A"}],"key":"vs4ZiYVtz7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport pandas as pd\nfrom whatnut import MonteCarloSimulation, DEFAULT_PARAMS\n\nsim = MonteCarloSimulation(seed=42)\nresult = sim.run(DEFAULT_PARAMS)","key":"hwonKFnsbx"},{"type":"outputs","id":"SXZp2FBtqAqQOTw8MzQjs","children":[],"key":"AC8sQGSWz6"}],"key":"vigsCKq2bD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary Table","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Rk4JFd3zrJ"}],"identifier":"summary-table","label":"Summary Table","html_id":"summary-table","implicit":true,"key":"EGVgudMWnM"}],"key":"MqRpYGdIQp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"summary = []\nfor r in result.results:\n    summary.append({\n        'Nut': r.nut_id.capitalize(),\n        'Median QALYs': f\"{r.median:.2f}\",\n        '95% CI': f\"[{r.ci_95[0]:.1f}, {r.ci_95[1]:.1f}]\",\n        'P(positive)': f\"{r.p_positive:.1%}\",\n        'P(>1 year)': f\"{r.p_gt_1_year:.1%}\",\n    })\n\npd.DataFrame(summary)","key":"puwnqGONii"},{"type":"outputs","id":"lgfBxb8KPT855sjujTN6E","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"         Nut Median QALYs      95% CI P(positive) P(>1 year)\n0     Walnut         2.86  [1.1, 5.5]      100.0%      98.2%\n1  Pistachio         2.75  [1.1, 5.3]      100.0%      98.0%\n2     Almond         2.59  [1.0, 4.9]      100.0%      97.4%\n3  Macadamia         2.59  [1.0, 5.1]      100.0%      97.4%\n4      Pecan         2.53  [0.9, 5.1]      100.0%      96.9%\n5     Peanut         2.49  [1.0, 4.8]      100.0%      97.2%\n6     Cashew         2.44  [0.9, 4.7]      100.0%      96.8%","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Nut</th>\n      <th>Median QALYs</th>\n      <th>95% CI</th>\n      <th>P(positive)</th>\n      <th>P(&gt;1 year)</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Walnut</td>\n      <td>2.86</td>\n      <td>[1.1, 5.5]</td>\n      <td>100.0%</td>\n      <td>98.2%</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Pistachio</td>\n      <td>2.75</td>\n      <td>[1.1, 5.3]</td>\n      <td>100.0%</td>\n      <td>98.0%</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Almond</td>\n      <td>2.59</td>\n      <td>[1.0, 4.9]</td>\n      <td>100.0%</td>\n      <td>97.4%</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Macadamia</td>\n      <td>2.59</td>\n      <td>[1.0, 5.1]</td>\n      <td>100.0%</td>\n      <td>97.4%</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Pecan</td>\n      <td>2.53</td>\n      <td>[0.9, 5.1]</td>\n      <td>100.0%</td>\n      <td>96.9%</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>Peanut</td>\n      <td>2.49</td>\n      <td>[1.0, 4.8]</td>\n      <td>100.0%</td>\n      <td>97.2%</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>Cashew</td>\n      <td>2.44</td>\n      <td>[0.9, 4.7]</td>\n      <td>100.0%</td>\n      <td>96.8%</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"Svu1b45IZ4"}],"key":"D11cV4ArsY"}],"key":"EtNgajR8YJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Forest Plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l5VjjqE6rJ"}],"identifier":"forest-plot","label":"Forest Plot","html_id":"forest-plot","implicit":true,"key":"LnV7rRXC70"}],"key":"HfWuEFLjzi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(10, 6))\n\nnuts = [r.nut_id.capitalize() for r in result.results]\nmedians = [r.median for r in result.results]\nci_low = [r.ci_95[0] for r in result.results]\nci_high = [r.ci_95[1] for r in result.results]\n\ny_pos = np.arange(len(nuts))\n\n# Plot error bars\nax.errorbar(medians, y_pos, xerr=[np.array(medians) - np.array(ci_low), \n                                   np.array(ci_high) - np.array(medians)],\n            fmt='o', capsize=5, capthick=2, markersize=10, color='teal')\n\n# Add reference line for category effect\nax.axvline(result.category_effect.median, color='gray', linestyle='--', \n           label=f'Any nut: {result.category_effect.median:.1f} QALYs')\n\nax.set_yticks(y_pos)\nax.set_yticklabels(nuts)\nax.set_xlabel('QALYs (95% CI)')\nax.set_title('Lifetime QALY Impact by Nut Type')\nax.legend()\nax.invert_yaxis()\n\nplt.tight_layout()\nplt.show()","key":"snHvXtGbiz"},{"type":"outputs","id":"u7SCPyawQ19P3eFML3cWz","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"fe64fc37736973578f348b25dba2fca6","path":"/whatnut//build/fe64fc37736973578f348b25dba2fca6.png"}}},"key":"I9GeKApajX"}],"key":"Ujy9pIi6zS"}],"key":"yg6IpuzTdq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Key Insights","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ssUvjDBdT2"}],"identifier":"key-insights","label":"Key Insights","html_id":"key-insights","implicit":true,"key":"jDPQLAN0UW"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Walnut leads","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IA4ILevje8"}],"key":"mEC4tMqV3J"},{"type":"text","value":" with ~2.9 QALYs, driven by strong CVD outcome data and unique omega-3 content","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y35MxCojnn"}],"key":"JcjZrTXhmf"}],"key":"ut2JOnHBDy"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The spread is small","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VUi9nFOknR"}],"key":"jNJ5TA1Gzh"},{"type":"text","value":" - only ~0.7 QALYs between best (walnut) and worst (cashew)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZAB1uQza5w"}],"key":"yoIDLpiYr7"}],"key":"WfDgEt7Vgr"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Any nut beats no nuts","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GQ80F5yTG2"}],"key":"ux8NJdBXNs"},{"type":"text","value":" - the category effect (~2.5 QALYs) far exceeds nut choice effects","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LYjUhatDSa"}],"key":"AGEYPjAt3S"}],"key":"ASFPDHDBy6"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Uncertainty varies","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SLa3LCUNWs"}],"key":"z3M43uUUCQ"},{"type":"text","value":" - nuts with less evidence (pecan, macadamia) have wider CIs","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xc1DfeXkdG"}],"key":"WG8LxxRmc1"}],"key":"rcl2wYJnga"}],"key":"lSvF4ggSkl"}],"key":"udzaeMOoke"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sensitivity Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D4Tiqvq4CN"}],"identifier":"sensitivity-analysis","label":"Sensitivity Analysis","html_id":"sensitivity-analysis","implicit":true,"key":"baryTKVNR0"}],"key":"iubNyXm3Fp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from whatnut.simulation import SimulationParams\n\n# Test different confounding assumptions\n# 0.6 = 60% causal effect, 40% confounding\n# 0.99 = nearly all causal\nconfounding_levels = [0.6, 0.7, 0.8, 0.9, 0.95]\nsensitivity_results = []\n\nfor conf in confounding_levels:\n    params = SimulationParams(confounding_adjustment=conf, n_simulations=5000)\n    res = sim.run(params)\n    walnut = next(r for r in res.results if r.nut_id == 'walnut')\n    sensitivity_results.append({\n        'Confounding': f\"{conf:.0%} causal\",\n        'Walnut QALYs': f\"{walnut.median:.2f}\",\n        'Category Effect': f\"{res.category_effect.median:.2f}\",\n    })\n\npd.DataFrame(sensitivity_results)","key":"a0kw3zCAVM"},{"type":"outputs","id":"NbDZ65PImGHKKzm3al5iM","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"  Confounding Walnut QALYs Category Effect\n0  60% causal         2.10            1.90\n1  70% causal         2.46            2.29\n2  80% causal         2.85            2.58\n3  90% causal         3.24            2.94\n4  95% causal         3.42            3.12","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Confounding</th>\n      <th>Walnut QALYs</th>\n      <th>Category Effect</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>60% causal</td>\n      <td>2.10</td>\n      <td>1.90</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>70% causal</td>\n      <td>2.46</td>\n      <td>2.29</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>80% causal</td>\n      <td>2.85</td>\n      <td>2.58</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>90% causal</td>\n      <td>3.24</td>\n      <td>2.94</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>95% causal</td>\n      <td>3.42</td>\n      <td>3.12</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"nTBLS9WtPF"}],"key":"v78dkEkvpL"}],"key":"poVz9U0nkz"}],"key":"tpHPeUV7y8"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Monte Carlo Simulation","url":"/simulation","group":"Analysis"}}},"domain":"http://localhost:3007"}